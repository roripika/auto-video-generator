<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Auto Explainer Script Editor</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="app-title">Auto Video Generator</div>
      <div class="left-controls">
        <span class="meta">台本編集タブでテーマ選択</span>
      </div>
      <div class="right-controls">
        <button id="settingsBtn" class="ghost">設定</button>
        <button id="openScriptBtn">開く</button>
        <button id="saveScriptBtn" class="primary">保存</button>
        <button id="saveScriptAsBtn">別名で保存</button>
        <button id="schedulerBtn" class="ghost">定期実行</button>
      </div>
    </header>
    <div class="tabs">
      <button class="tab-btn active" data-tab="tab-script">台本編集</button>
      <button class="tab-btn" data-tab="tab-assets">素材・音声</button>
      <button class="tab-btn" data-tab="tab-video">動画・アップロード</button>
    </div>

    <div id="tab-script" class="tab-content active">
      <section class="panel panel--theme">
        <h2>テーマ選択</h2>
        <div class="theme-controls">
          <button id="newScriptBtn">新規 (テーマから)</button>
          <select id="themeSelect"></select>
        </div>
      </section>

      <section class="panel panel--ai">
        <h2>AI 台本生成 <button class="info-btn" data-info="brief">i</button></h2>
        
        <fieldset style="border: 1px solid #ddd; border-radius: 4px; padding: 12px; margin-bottom: 16px;">
          <legend style="padding: 0 8px; font-weight: 600;">AIアイディア生成</legend>
          
          <!-- AIが生成 -->
          <div style="margin-bottom: 16px;">
            <div style="font-weight: 500; margin-bottom: 8px; color: #555;">・AIが生成</div>
            <div style="padding-left: 16px;">
              <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-bottom:8px;">
                <label>
                  トレンドカテゴリ
                  <select id="trendCategorySelect">
                    <option value="">指定なし（全般）</option>
                    <option value="ライフハック">ライフハック</option>
                    <option value="時事ネタ">時事ネタ</option>
                    <option value="統計話題">統計話題</option>
                    <option value="科学トリビア">科学トリビア</option>
                    <option value="健康常識（断定NG）">健康常識</option>
                    <option value="歴史の豆知識">歴史の豆知識</option>
                    <option value="宇宙・天文">宇宙・天文</option>
                    <option value="心理学・行動科学">心理学・行動科学</option>
                    <option value="テクノロジー動向">テクノロジー動向</option>
                    <option value="カルチャー・エンタメ">カルチャー・エンタメ</option>
                  </select>
                </label>
                <label>
                  追加キーワード
                  <input id="trendExtraKeywordInput" type="text" placeholder="例: 自動車" />
                </label>
              </div>
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="margin: 0; min-width: 200px;">AIトレンドからアイディア生成:</label>
                <button id="trendBriefBtnLlm" class="ghost">文言生成</button>
              </div>
            </div>
          </div>
          
          <!-- Youtubeから選択 -->
          <div>
            <div style="font-weight: 500; margin-bottom: 8px; color: #555;">・Youtubeから選択</div>
            <div style="padding-left: 16px;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <label style="margin: 0; min-width: 200px;">Youtubeランキングからアイディア生成:</label>
                <button id="trendBriefBtnYoutube" class="ghost">文言生成</button>
              </div>
            </div>
          </div>
        </fieldset>

        <label style="display: block; margin-bottom: 4px; font-weight: 500;">
          アイディアフレーズ
        </label>
        <textarea
          id="aiBriefInput"
          placeholder="例: 忙しい朝でもできる驚きの時短ライフハックをランキング形式で紹介したい…"
        ></textarea>
        <div class="ai-controls">
          <label>
            セクション数
            <input id="aiSectionsInput" type="number" min="3" max="10" value="5" />
          </label>
          <label class="inline-checkbox">
            <input id="aiShortAdjust" type="checkbox" />
            <span>ショート調整（1分以内目標）</span>
          </label>
          <button id="aiGenerateBtn" class="primary">AI で生成</button>
        </div>
        <p class="ai-hint">テーマは上部セレクトで選択したものが利用されます。</p>
      </section>

      <main class="layout">
        <section class="panel panel--sidebar">
          <h2>セクション一覧</h2>
          <ul id="sectionList" class="section-list"></ul>
          <button id="addSectionBtn">セクション追加</button>
        </section>

        <section class="panel panel--form">
          <h2>セクション編集 <button id="openPreviewBtn" class="ghost" style="margin-left: 12px;">プレビューを開く</button></h2>
          <div id="sectionForm" class="form-grid"></div>
        </section>
      </main>
    </div>

    <div id="tab-assets" class="tab-content">
      <section class="panel panel--assets">
        <h2>背景素材 <button class="info-btn" data-info="assets">i</button></h2>
        <label>現在の背景
          <input id="bgPathInput" type="text" placeholder="assets/cache/..." readonly />
        </label>
        <div class="asset-search">
          <label>キーワード
            <input id="assetKeywordInput" type="text" placeholder="例: 未来的な街並み" />
          </label>
          <label>種類
            <select id="assetKindSelect">
              <option value="video">動画</option>
              <option value="image">画像</option>
            </select>
          </label>
          <label class="inline-checkbox">
            <input id="assetAllowAICheck" type="checkbox" />
            <span>AI画像生成も許可</span>
          </label>
          <div class="asset-actions" style="gap:8px; display:flex; flex-wrap:wrap;">
            <button id="assetFetchBtn" class="primary">自動取得</button>
            <button id="assetOpenWindowBtn" class="ghost">別ウインドウで検索</button>
          </div>
          <ul id="assetResultList" class="asset-result-list"></ul>
        </div>
        <div class="asset-actions" style="gap:8px; display:flex; flex-wrap:wrap;">
          <button id="bgBrowseBtn">ファイルを選択</button>
        </div>
      </section>

      <section class="panel panel--text-style">
        <h2>テキストスタイル <button class="info-btn" data-info="textstyle">i</button></h2>
        <div class="text-style-grid">
          <label>フォント
            <input id="textFontInput" type="text" placeholder="Noto Sans JP" />
          </label>
          <label>フォントサイズ
            <input id="textFontSizeInput" type="number" min="24" max="120" step="2" />
          </label>
          <label>文字色
            <input id="textFillInput" type="color" />
          </label>
          <label>縁取り色
            <input id="textStrokeColorInput" type="color" />
          </label>
          <label>縁取り幅
            <input id="textStrokeWidthInput" type="number" min="0" max="20" />
          </label>
          <label>位置 X
            <input id="textPosXInput" type="text" placeholder="center / left+40 / 数値" />
          </label>
          <label>位置 Y
            <input id="textPosYInput" type="text" placeholder="bottom-180 / 数値" />
          </label>
          <label>アニメーション
            <input id="textAnimationInput" type="text" placeholder="fade, slide-in 等" />
          </label>
        </div>
      </section>

      <section class="panel panel--bgm">
        <h2>BGM設定 <button class="info-btn" data-info="bgm">i</button></h2>
        <label>ファイル/URL
          <input id="bgmFileInput" type="text" placeholder="assets/bgm/lofi.mp3 または https://..." />
        </label>
        <div class="asset-actions" style="gap:8px; display:flex; flex-wrap:wrap;">
          <button id="bgmBrowseBtn">ファイルを選択</button>
          <button id="bgmOpenWindowBtn" class="ghost">ライブラリから選ぶ</button>
          <button id="bgmClearBtn" class="ghost">クリア</button>
        </div>
        <div class="bgm-grid">
          <label>音量 (dB)
            <input id="bgmVolumeInput" type="number" step="1" min="-40" max="0" placeholder="-10" />
          </label>
          <label>ナレーション時の ducking (dB)
            <input id="bgmDuckingInput" type="number" step="1" min="-40" max="0" placeholder="-16" />
          </label>
        </div>
        <label>ライセンス表記メモ
          <input id="bgmLicenseInput" type="text" placeholder="例: Music: _____ (Pixabay License)" />
        </label>
      </section>

      <section class="panel panel--audio">
        <h2>音声 & タイムライン</h2>
        <div class="audio-controls">
          <button id="audioGenerateBtn">VOICEVOX で音声生成</button>
          <button id="timelineRefreshBtn">タイムライン更新</button>
          <button id="audioClearBtn" class="ghost">音声キャッシュ削除</button>
        </div>
        <div class="audio-controls">
          <label>話者
            <select id="voiceSpeakerSelect"></select>
          </label>
          <span id="voiceSpeakerLabel" class="meta"></span>
        </div>
        <div id="timelineSummary" class="timeline-summary">未計算</div>
      </section>
    </div>

    <div id="tab-video" class="tab-content">
      <section class="panel panel--video">
        <h2>動画生成</h2>
        <div class="video-controls">
          <button id="videoGenerateBtn" class="primary">動画を生成</button>
          <button id="videoOpenBtn" disabled>生成動画を開く</button>
          <button id="videoUploadBtn" class="ghost" disabled>YouTubeへアップロード</button>
          <label class="inline-checkbox">
            <input type="checkbox" id="clearAudioOnVideo" checked />
            <span>音声キャッシュをクリア</span>
          </label>
          <label class="inline-checkbox">
            <input type="checkbox" id="shortModeCheck" />
            <span>ショート動画モード（縦長・60秒以内）</span>
          </label>
        </div>
        <textarea id="videoLog" class="video-log" readonly></textarea>
      </section>

      <section class="panel panel--history">
        <div class="history-header">
          <h2>過去の生成動画</h2>
          <div class="history-actions">
            <button id="historyRefreshBtn" class="ghost">更新</button>
          </div>
        </div>
        <ul id="historyList" class="history-list"></ul>
      </section>
    </div>

    <div id="settingsModal" class="modal hidden">
      <div class="modal__content">
        <div class="modal__header">
          <h2>AI 設定</h2>
          <button id="settingsCloseBtn" class="ghost">&times;</button>
        </div>
        <div class="modal__body">
          <label>AI プロバイダ
            <select id="settingsProvider"></select>
          </label>
          <label>API Key
            <input id="settingsApiKey" type="password" placeholder="sk-..." autocomplete="off" />
          </label>
          <label>Base URL
            <input id="settingsBaseUrl" type="text" placeholder="https://api.openai.com/v1" />
          </label>
          <label>モデル ID
            <input id="settingsModel" type="text" placeholder="gpt-4o-mini" />
          </label>
          <p id="providerHint" class="modal__hint"></p>
          <p class="modal__hint">※ 設定ファイルは `settings/ai_settings.json` に保存されます（Git 管理対象外）。</p>
          <hr />
          <h3>素材・画像生成 API</h3>
          <label>素材検索の優先順位
            <select id="settingsProviderOrder">
              <option value="pexels,pixabay">Pexels → Pixabay</option>
              <option value="pixabay,pexels">Pixabay → Pexels</option>
            </select>
          </label>
          <label>検索件数 (最大)
            <input id="settingsMaxResults" type="number" min="1" max="10" value="5" />
          </label>
          <label>Pexels API Key
            <input id="settingsPexelsKey" type="password" placeholder="PEXELS_API_KEY" autocomplete="off" />
          </label>
          <p class="modal__hint">
            取得: <a href="https://www.pexels.com/api/" target="_blank" rel="noreferrer" data-external-link="true">https://www.pexels.com/api/</a>
          </p>
          <label>Pixabay API Key
            <input id="settingsPixabayKey" type="password" placeholder="PIXABAY_API_KEY" autocomplete="off" />
          </label>
          <p class="modal__hint">
            取得: <a href="https://pixabay.com/api/docs/" target="_blank" rel="noreferrer" data-external-link="true">https://pixabay.com/api/docs/</a>
          </p>
          <label>Stability API Key (AI画像生成)
            <input id="settingsStabilityKey" type="password" placeholder="STABILITY_API_KEY" autocomplete="off" />
          </label>
          <p class="modal__hint">
            取得: <a href="https://platform.stability.ai/" target="_blank" rel="noreferrer">https://platform.stability.ai/</a>
          </p>
          <h3>BGM / YouTube</h3>
          <label>YouTube API Key
            <input id="settingsYoutubeKey" type="password" placeholder="YOUTUBE_API_KEY" autocomplete="off" />
          </label>
          <p class="modal__hint">
            取得: <a href="https://console.cloud.google.com/apis/library/youtube.googleapis.com" target="_blank" rel="noreferrer" data-external-link="true">Google Cloud Console (YouTube Data API)</a>
          </p>
          <label>YouTube OAuth client_secrets.json パス
            <input id="settingsYoutubeClientSecrets" type="text" placeholder="./client_secret_xxx.json" />
          </label>
          <label>YouTube OAuth credentials 保存先
            <input id="settingsYoutubeCredentials" type="text" placeholder="~/.config/auto-video-generator/youtube_credentials.pickle" />
          </label>
          <label>BGM ディレクトリ
            <input id="settingsBgmDir" type="text" placeholder="assets/bgm" />
          </label>
          <p class="modal__hint">相対パスはプロジェクトルート（auto-video-generator）からの相対になります。</p>
          <label>デフォルト BGM (YouTube URL または動画ID)
            <input id="settingsYoutubeForce" type="text" placeholder="https://www.youtube.com/watch?v=..." />
          </label>
          <p class="modal__hint">ここに指定した動画を優先的にダウンロードして BGM として利用します。</p>
        </div>
        <div class="modal__actions">
          <button id="settingsCancelBtn">キャンセル</button>
          <button id="settingsSaveBtn" class="primary">保存</button>
        </div>
      </div>
    </div>

    <script src="renderer.js"></script>
  </body>
</html>
