# 環境構築ガイド（Auto Video Generator v2.0）

本ドキュメントは、初心者が macOS 上で本アプリの環境をセットアップし、最低限の動作確認ができるようにするための手順書です。  
前提OS: macOS（動作確認は Apple Silicon）。Windows/Linux でも近い手順ですが、Homebrew 部分は各環境に置き換えてください。

---

## 1. 前提と準備
- **必須ツール**: git, zsh（macOS標準）, Homebrew, Xcode Command Line Tools  
  - まだなら `xcode-select --install` を実行。
  - Homebrew: https://brew.sh/ を参考にインストール。
- **API/認証情報**  
  - Pexels API Key（背景素材取得）  
  - Pixabay API Key（背景素材取得のフォールバック）  
  - YouTube API: client_secret.json（OAuthクライアント）、認証済みの credentials.pickle（後述）  
  - OpenAI/Gemini/Claude など LLM 用 API Key（`settings/ai_settings.json` に設定）

---

## 2. セットアップ手順（初心者向け）
1) リポジトリ取得  
```bash
git clone <このリポジトリのURL>
cd auto-video-generator
```

2) 依存インストール & 仮想環境作成  
   - `Setup.command` をダブルクリック（またはシェルで実行）  
   - 内部で行うこと:  
     - Homebrew があれば `python@3.11` を優先  
     - pyenv があれば `3.11.14` をインストールして利用  
     - `.venv` を作成し、`requirements.txt` と YouTube 認証系ライブラリ（google-auth / google-api-python-client）をインストール  
     - VOICEVOX Engine セットアップスクリプトを実行（失敗時は後で再実行可）  
   - 失敗する場合の代表例:  
     - Xcode/CLT 不足 → `xcode-select --install`  
     - pyenv ビルド失敗（libintl などのシンボルエラー） → Homebrew の python@3.11 を使う（pyenv を外す）  

3) 設定ファイルの用意  
   - `settings/ai_settings.json` をアプリから設定（プロバイダ、APIキー、Base URL、モデルID、素材APIキー等）。  
   - YouTube 認証:  
     - 設定画面で `client_secret*.json` と `credentials.pickle` のパスを指定（`.config/auto-video-generator/` がデフォルト）。  
     - 初回アップロードや認証テスト時にブラウザ認証フローが走るので指示に従って許可。  

---

## 3. 動作確認
1) Python バージョン確認  
```bash
source .venv/bin/activate
python -V   # 3.11 系が出ること
```
2) 簡易スクリプト生成（LLM必須）  
```bash
python scripts/generate_script_from_brief.py --brief "最新の家事時短ハックを5つ紹介" --stdout --provider openai --model gpt-4o-mini --api-key "$OPENAI_API_KEY"
```
3) UI 起動  
   - `Start_DesktopApp.command` を実行して UI が開くことを確認。

---

## 4. トラブルシュート（よくあるケース）
- pyenv で Python ビルドが失敗  
  - Homebrew の `python@3.11` に切り替える（`PYENV_PYTHON_VERSION` を外すか Homebrew の python3.11 を優先）。  
  - Xcode/CLT を最新化 (`xcode-select --install`)。  
- 背景素材取得で 400 エラー  
  - Pixabay の lang/キーワード長制限に注意。Pexelsキーを優先、Pixabayはフォールバックに。  
- YouTube アップロード失敗  
  - `uploadLimitExceeded`（本数制限）は待つしかありません。アップロード失敗でも処理継続するようコードは調整済み。  
  - 認証不足 → `settings` で client_secret/credentials を再指定し、認証テストを実行。  

---

## 5. 付録：`Setup.command` でやっていること
- Homebrew があれば `ffmpeg`, `p7zip`, `gettext`, `pyenv` をインストール（存在しない場合）。  
- Python は pyenv 3.11.14（または Homebrew python@3.11）を優先。  
- `.venv` を作成し、`requirements.txt` と YouTube 認証用ライブラリをインストール。  
- VOICEVOX Engine セットアップスクリプトの実行（任意）。  

---

## 6. 生成物とディレクトリ
- 出力動画: `outputs/rendered/*.mp4` （SRT/JSON/YAML スナップショットも同名で保存）  
- キャッシュ/音声: `work/audio`, `assets/cache/` など。不要なら削除可。  
- スケジュール設定: `settings/schedule.json`（Git管理外）  
- 設定ファイル: `settings/ai_settings.json`（Git管理外）

---

以上で環境構築と基本確認は完了です。問題が続く場合は、ログ（`logs/` やターミナル出力）を添えてお知らせください。  
