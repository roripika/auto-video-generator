# Playwright 手順記録・ドキュメント生成 仕様書

本仕様書は、GUI 操作を Playwright で自動実行し、スクリーンショットと操作ログを取得したうえで LLM による Markdown 手順書を生成するまでの要件をまとめる。

## 目的
- 手動手順書作成の手間と抜け漏れを減らし、再現性のあるガイドを自動生成する。

## ファイル構成
- `docs/stepdocs/` … 生成物の格納先ルート
  - `screenshots/` … 各ステップのスクリーンショット
  - `steps.json` … 取得したメタデータ（URL/タイトル/アクション/セレクタ/注釈/スクショ相対パス）
  - `guide.md` … LLM で生成された手順書（任意）

## StepRecorder 要件
- 各ステップで連番スクショを `screenshots/stepXX.png` 形式で保存。
- メタデータに含める項目：timestamp, URL, page title, action, target selector, note, screenshot path。
- 収集データを `steps.json` に JSON で保存（{ "steps": [...] }）。
- 例外発生時も steps.json を残すため、終了フックで save を呼ぶ。

## Playwright 実行フロー（例）
1. `stepdocs/` 配下にある `package.json` を利用し、`cd stepdocs && npm install` で Playwright を導入。
2. 例: `npm run record` で `stepdocs/record_example.js` を実行し、StepRecorder がスクショとメタデータを保存。
3. スクリプトでブラウザを起動し、StepRecorder をインスタンス化。
4. 重要操作ごとに `await recorder.snap({ action, target, note })` を呼び、スクショ＋メタデータを記録。
5. 完了後 `recorder.save()` で `steps.json` とスクショを保存。

## LLM 変換（ガイド生成）
- 入力：`steps.json` と `screenshots/` のファイル名。
- 出力：Markdown (`guide.md`)、各ステップ見出し＋スクショ埋め込み＋note をもとにした説明文。
- プロンプト例：「step データをもとに人間向けの手順書を作成。各ステップに見出しと画像リンクを含める。」

## エラー/運用上の考慮
- 失敗時も steps.json は保存し、再実行時に上書き可能にする。
- フルページスクショが不要な場合は任意の clip 範囲を指定できるよう拡張可。
- CI での自動化を想定し、出力先ディレクトリは既存ファイルを上書きしても安定するようにする。
