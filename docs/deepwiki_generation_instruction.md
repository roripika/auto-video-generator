# DeepWiki風 ドキュメント生成指示書

## 目的
- DeepWikiスタイル（短文・見出し駆動・リンク豊富）で技術ドキュメントを安定生成するための汎用指示。
- GPT/Claude/Codex 等、モデル非依存で再現できる手順を明文化。
- 既存コードベース・仕様・機能説明など、あらゆるテーマに適用可能。

## ドキュメントレベルの定義
ドキュメントは以下の3段階で作成する：

### Lv1: プロジェクト全体の概要構成
**目的**: 全体像の把握、意思決定の材料
**読者**: 経営層、新メンバー、PM、外部協力者
**粒度**: 高レベル、抽象度高
**重点**:
- プロジェクトの目的・価値提案
- 主要コンポーネントの関係性（アーキテクチャ図）
- 技術スタック・外部依存
- デプロイ戦略・運用フロー
- 既知の課題と今後の方向性

**含めるセクション**:
- TL;DR
- 背景（なぜこのプロジェクトが必要か）
- システム概要（Mermaid図で全体構成）
- 主要機能一覧（各機能へのリンク）
- 技術スタック
- まとめ
- 次のアクション

**含めないもの**: 詳細なコード、実装手順、APIエンドポイント

---

### Lv2: 機能仕様書
**目的**: 機能単位の理解、開発・テストの指針
**読者**: 開発者、QA、PM
**粒度**: 中レベル、機能単位
**重点**:
- 機能の目的・ユースケース
- 入力/出力・データフロー
- 主要なAPI/CLI/UI操作
- 設定ファイル・パラメータ
- エラーハンドリング
- 運用時の注意点

**含めるセクション**:
- TL;DR
- 用語・前提
- 背景（なぜこの機能が必要か）
- 機能概要（フロー図）
- 使用方法（CLI/API/UI）
- 設定とパラメータ（表形式）
- 運用（推奨フロー、落とし穴）
- 参考（関連機能へのリンク）
- まとめ
- 次のアクション

**含めないもの**: 実装の詳細なアルゴリズム、コードの行単位解説

---

### Lv3: 詳細仕様書
**目的**: 実装の理解、保守・拡張作業
**読者**: 開発者（実装・保守担当）
**粒度**: 低レベル、コード単位
**重点**:
- クラス/関数/モジュールの役割
- アルゴリズムの詳細
- データ構造・スキーマ
- ファイルパスと行番号
- 依存関係とインポート
- エッジケース・バグ修正履歴

**含めるセクション**:
- TL;DR
- 用語・前提
- 背景（なぜこの実装方法を選んだか）
- 詳細（モジュール構成、主要関数、アルゴリズム）
- コードリーディング（重要箇所の抜粋と解説）
- データ構造（スキーマ、型定義）
- 運用（デバッグ方法、よくあるバグ）
- 参考（関連コードへのリンク）
- まとめ
- 次のアクション

**含めるもの**: コードスニペット（行番号付き）、詳細なコメント、複雑なロジックの説明

---

## 出力フォーマット（テンプレ）
以下の階層構造に従う（Qiita DeepWiki記事の標準構成）。
**レベルに応じてセクションを調整する**（詳細は「ドキュメントレベルの定義」を参照）。

### 基本構成（全レベル共通）
```
# <プロジェクト/機能名>: <トピック>

## TL;DR（概要 3-5行）
- 課題 / 何を / なぜ / どう解決

## 用語・前提
- 固有名詞や依存前提を5行以内で列挙

## 背景（なぜ今これが必要か）
- 課題の文脈
- 既存手法の限界（Lv1では省略可）
- 解決のモチベーション

## 詳細
### [Lv1] システム概要
- 全体アーキテクチャ（Mermaid図）
- 主要コンポーネント一覧

### [Lv2] 機能概要
- フロー図（Mermaid）
- 使用方法（CLI/API/UI）
- 設定とパラメータ（表形式）

### [Lv3] 実装詳細
- モジュール構成
- 主要関数/クラス（コードスニペット、行番号付き）
- アルゴリズム解説
- データ構造/スキーマ

## 運用
### 推奨運用フロー
- 日常的な使い方

### 落とし穴と対策
- ありがちな失敗と回避策

## 参考
- 内部/外部リンクを列挙

## まとめ
- 本文の要点を3-5行で再整理

## 次のアクション
- 読者が次に何をすべきか（2-3項目）

## 追記/更新ログ
- YYYY-MM-DD: 一行で差分
```

## 文体ルール
- 一文短く、断定口調。「〜する」「〜で運用」。
- 見出しに結論を含める（例: 「フォントはfc-matchで解決」）。
- 見出しに絵文字を配置（例: 「## 🏗️ アーキテクチャ」「## 🔧 実装ポイント」）。
- 箇条書き主体（7割）。段落は3行以内。
- 余計な形容詞を避け、事実→理由→操作順を簡潔に。

## 出力ルール（厳守）

### 1. 見出しと構造
- H1（#）: ドキュメントタイトルのみ
- H2（##）: 主要セクション（TL;DR、背景、詳細、運用、参考、まとめ、次のアクション）
- H3（###）: サブセクション（アーキテクチャ、実装手順、推奨フロー等）
- 各見出しに適切な絵文字を配置

### 2. コードとファイル参照
- **コードスニペット**: 言語指定付きコードブロック。重要行にコメント追加。
  ```python
  # フォント名をシステムパスに解決
  def _resolve_font_path(font_name: str) -> str:
      result = subprocess.run(['fc-match', '-f', '%{file}', font_name])
      return result.stdout.strip()
  ```
- **ファイルパス**: プロジェクトルートからの相対パス。行番号範囲を含める。
  - 例: `(src/render/ffmpeg_runner.py:43-89)`
- **ソースコード参照**: 実装の根拠として具体的なファイルと行番号を明記。

### 3. 図表の記述
- **Mermaid図**: 必ず ` ```mermaid ``` ` で囲む。
  ```mermaid
  graph LR
    A[台本YAML] --> B[音声生成]
    B --> C[映像合成]
    C --> D[YouTube投稿]
  ```
- **表**: 設定値、API一覧、比較表等で使用。
  | 項目 | 説明 | デフォルト |
  |------|------|-----------|
  | speaker_id | VOICEVOXスピーカー | 1 |

### 4. リンク記述
- **内部リンク**: 相対パスで他セクション参照。
  - 例: `詳細は [アーキテクチャ](./03-アーキテクチャ.md) を参照`
- **外部リンク**: URL明記。公式ドキュメント等。
- **ファイルリンク**: プロジェクト内ファイルへのリンク。
  - 例: `[設定ファイル](../configs/config.yaml)`

### 5. 一貫性
- 全セクションで記述スタイルを統一。
- 用語の使い方を統一（例: 「台本」「スクリプト」を混在させない）。
- 絵文字は意味を持つものを選択（📖概要、🚀スタート、🏗️構成、🔧実装、⚠️注意）。

## 生成プロンプト例
以下のテンプレートをAIに渡すことで、任意のテーマでDeepWiki風ドキュメントを生成可能。

### 入力情報
- **対象**: [機能名/コンポーネント名/システム名など]
- **テーマ**: [何を説明するか: 例「フォント解決の仕組み」「API認証フロー」]
- **読者**: [開発者/運用担当/新メンバーなど]
- **目的**: [判断材料/共有/運用手順/トラブルシュート]
- **ソース**: [参照するコード/設計書/障害レポートなど]

### AIへの指示プロンプト

#### レベル指定付きプロンプト（重要）
```
以下のテーマでDeepWiki風ドキュメントを作成してください。

【レベル】: <Lv1/Lv2/Lv3のいずれか>
【テーマ】: <対象とテーマ>
【読者】: <想定読者>
【目的】: <このドキュメントで何を達成するか>
【参照情報】: <コード/設計書/既存ドキュメントの要点>

レベルに応じた出力（重要）:

【Lv1: プロジェクト全体の概要構成】の場合:
- 全体像重視、抽象度高
- 含める: TL;DR、背景、システム概要（Mermaid図）、主要機能一覧、技術スタック、まとめ、次のアクション
- 除外: 詳細なコード、実装手順、APIエンドポイント
- 目標文量: 500-800語

【Lv2: 機能仕様書】の場合:
- 機能単位の理解、開発・テストの指針
- 含める: TL;DR、用語、背景、機能概要（フロー図）、使用方法、設定とパラメータ（表形式）、運用、参考、まとめ、次のアクション
- 除外: 実装の詳細なアルゴリズム、コードの行単位解説
- 目標文量: 700-1200語

【Lv3: 詳細仕様書】の場合:
- 実装の理解、保守・拡張作業
- 含める: TL;DR、用語、背景、詳細（モジュール構成、主要関数、アルゴリズム）、コードリーディング（行番号付き）、データ構造、運用（デバッグ方法）、参考、まとめ、次のアクション
- 必須: コードスニペット、ファイルパス（行番号範囲）、詳細なコメント
- 目標文量: 1000-2000語

出力ルール（厳守）:
- 見出しに絵文字を配置（📖概要、🚀スタート、🏗️構成、🔧実装、⚠️注意等）
- コードスニペット: 言語指定付き、重要行にコメント
- ファイルパス: プロジェクトルートからの相対パス、行番号範囲を含める
  例: (src/render/ffmpeg_runner.py:43-89)
- Mermaid図: アーキテクチャ/フロー図は ```mermaid ``` で囲む
- 内部リンク: 相対パスで他セクション参照
  例: 詳細は [実装ポイント](#実装ポイント) を参照
- 表: 設定値、API一覧等はMarkdownテーブルで記述
- 用語統一: 同じ概念に対して異なる用語を使わない

文体ルール:
- 短文・断定口調（「〜する」「〜で運用」）
- 見出しに結論を含める
- 箇条書き主体（7割）、段落は3行以内
- 余計な形容詞を避け、事実→理由→操作順
```

## 品質チェックリスト
- TL;DRで「何を・なぜ・どう」が読める。
- 背景セクションで課題の文脈と既存手法の限界が明確。
- 詳細セクションが「アーキテクチャ→手順→ポイント」の3層構造。
- 運用セクションが「推奨フロー」と「落とし穴」で分離。
- 見出しだけで流れが追える。
- 固有名詞/前提が冒頭で定義されている。
- まとめで本文の要点が再整理されている。
- 次のアクションが具体的（2-3項目）。
- 参考リンクがある。
- 追記/更新ログに日付と差分が1行ある。

## 運用ルール
- 新機能/障害/仕様変更ごとに1本作成。
- 更新時は「追記」に日付と差分を追加し、既存内容を上書きしない。
- 週次で目次ページからリンクを整理（未リンク禁止）。
- 既存コードベースの仕様書化には、この指示書+ソースコード参照を組み合わせる。
- ファイル間リンクは相対パスで統一。絶対パスは使用しない。

## ファイル配置（複数ページの場合）
単一ドキュメントでなく複数ページに分割する場合：

- **配置場所**: `wiki/` または `docs/` ディレクトリ
- **命名規則**: レベル接頭辞 + 数字 + タイトル
  - Lv1例: `lv1-01-概要.md`, `lv1-02-アーキテクチャ.md`
  - Lv2例: `lv2-01-台本生成機能.md`, `lv2-02-音声合成機能.md`
  - Lv3例: `lv3-01-ffmpeg_runner詳細.md`, `lv3-02-timeline計算ロジック.md`
- **階層構造**:
  ```
  wiki/
  ├── 00-目次.md                    # 全体の目次
  ├── lv1/                          # Lv1: プロジェクト全体
  │   ├── 01-概要.md
  │   ├── 02-アーキテクチャ.md
  │   └── 03-技術スタック.md
  ├── lv2/                          # Lv2: 機能仕様
  │   ├── 01-台本生成機能.md
  │   ├── 02-音声合成機能.md
  │   ├── 03-映像レンダリング機能.md
  │   └── 04-YouTube投稿機能.md
  └── lv3/                          # Lv3: 詳細仕様
      ├── 01-ffmpeg_runner詳細.md
      ├── 02-timeline計算ロジック.md
      ├── 03-フォント解決システム.md
      └── 04-LLM台本生成詳細.md
  ```
- **目次ファイル**: `00-目次.md` を作成し、3レベルすべてにリンク
- **目次の内容例**:
  ```markdown
  # AutoVideoGenerator Wiki
  
  ## 📚 目次
  
  ### Lv1: プロジェクト全体の概要構成
  - [📖 概要](./lv1/01-概要.md)
  - [🏗️ アーキテクチャ](./lv1/02-アーキテクチャ.md)
  - [⚙️ 技術スタック](./lv1/03-技術スタック.md)
  
  ### Lv2: 機能仕様書
  - [🎬 台本生成機能](./lv2/01-台本生成機能.md)
  - [🎙️ 音声合成機能](./lv2/02-音声合成機能.md)
  - [🎥 映像レンダリング機能](./lv2/03-映像レンダリング機能.md)
  - [📺 YouTube投稿機能](./lv2/04-YouTube投稿機能.md)
  
  ### Lv3: 詳細仕様書
  - [🔧 ffmpeg_runner詳細](./lv3/01-ffmpeg_runner詳細.md)
  - [⏱️ timeline計算ロジック](./lv3/02-timeline計算ロジック.md)
  - [🔤 フォント解決システム](./lv3/03-フォント解決システム.md)
  - [🤖 LLM台本生成詳細](./lv3/04-LLM台本生成詳細.md)
  ```

## 適用例
### ケース1: 既存実装から仕様書を起こす
**Lv1（プロジェクト全体）**:
- README、設計書、主要ファイルを読み込み。
- 上記プロンプトの「参照情報」にプロジェクト構成・技術スタックを記載。
- 「このプロジェクトの全体像をLv1でまとめて」と指示。

**Lv2（機能仕様）**:
- 特定機能のスクリプト・モジュールを読み込み。
- 「参照情報」に機能の入出力・フローを記載。
- 「この機能の仕様をLv2でまとめて」と指示。

**Lv3（詳細仕様）**:
- 特定ファイルの実装を詳細に読み込み。
- 「参照情報」に関数・クラス・アルゴリズムの要点を記載。
- 「この実装の詳細をLv3でまとめて」と指示。

### ケース2: 障害対応をドキュメント化
**Lv2レベルで作成**:
- 障害内容・原因・対策を「参照情報」に記載。
- 「この障害の対応手順をLv2で」と指示。

### ケース3: 新機能の設計書
**Lv1→Lv2→Lv3の順で作成**:
- Lv1: 新機能の位置づけ、既存システムへの影響。
- Lv2: 機能仕様、API設計、フロー。
- Lv3: 実装方針、詳細設計、コード構造。

## 参考（元ネタ）
- Qiita: DeepWiki風まとめ方 https://qiita.com/a32-suzuki/items/c3540da3e009dab1bf97
