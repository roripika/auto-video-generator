# 📖 Auto Video Generator ドキュメント目次

このディレクトリには、自動解説動画ジェネレーター（Auto Video Generator）の DeepWiki スタイル ドキュメントを集約しています。
各ドキュメントは **Lv1（全体概要）→ Lv2（機能仕様）→ Lv3（詳細仕様）** の 3 段階の階層で構成されています。

---

## 📊 ドキュメント階層

### Lv1: 🎯 プロジェクト全体概要
**対象読者**: 経営層、新メンバー、プロジェクトマネージャー  
**読む時間**: 10 分  
**目的**: システム全体の構成・機能・技術スタック・リスク・運用方針を理解

- **[deepwiki_overview.md](../deepwiki_overview.md)**
  - システム概要
  - 主要機能一覧
  - 技術スタック
  - 実装ポイント
  - 運用・落とし穴
  - 追記ログ

---

### Lv2: 🔧 機能仕様書
**対象読者**: 開発者、QA エンジニア  
**読む時間**: 各 15-20 分  
**目的**: 各機能の入出力・パラメータ・使用方法・エラー対応を把握

#### 📝 [01-台本生成機能](lv2/01-台本生成機能.md)
トレンド取得 → LLM ブリーフ生成 → YAML 台本出力

- 背景・要件
- CLI / GUI 使用方法
- 設定パラメータ（category, extra_keyword, timeout 等）
- 運用フロー（日次実行、重複排除、リトライ）
- 落とし穴対策（LLM API 制限、JSON パース失敗）

#### 📐 [02-テロップ調整機能](lv2/02-テロップ調整機能.md)
テロップ文字幅計測 → 改行/縮小で画面外はみ出し防止

- 背景・仕様
- CLI / GUI 使用方法
- 設定パラメータ（max_chars, font_size, _short_scale 等）
- 運用フロー（日次、ショート特化、自動補完）
- 落とし穴対策（言語別計測精度、字数上限 36 文字警告）

#### 🎬 [03-映像レンダリング機能](lv2/03-映像レンダリング機能.md)
YAML 台本 → MP4 生成（ショート/通常自動判定、BGM ダッキング、素材統合）

- 背景・パイプライン概要
- CLI / GUI 使用方法
- 設定パラメータ（short_mode, bgm_file, ducking_amount 等）
- 運用フロー（日次、バッチ、トラブル対応）
- 落とし穴対策（真っ黒ビデオ、タイムスタンプズレ、BGM 音量問題）

#### 📤 [04-YouTube投稿機能](lv2/04-YouTube投稿機能.md)
OAuth 認証 → メタデータ抽出 → サムネ自動生成 → YouTube 投稿

- 背景・認証フロー
- CLI / GUI 使用方法
- 設定パラメータ（privacy_status, playlist_id, copyright_check 等）
- 運用フロー（手動投稿、自動スケジュール、トークン期限対応）
- 落とし穴対策（トークン有効期限 60 日、quota 制限、メタデータ検証）

---

### Lv3: 🛠️ 詳細仕様書
**対象読者**: 実装者、保守開発者  
**読む時間**: 各 20-30 分  
**目的**: 関数実装・コード参照・デバッグ方法を詳細に理解

#### ⚙️ [01-フォント解決システム](lv3/01-フォント解決システム.md)
Font name → 実ファイルパス解決、macOS フォールバック

- 実装詳細：`_resolve_font_path()` 関数（[src/render/ffmpeg_runner.py](../../src/render/ffmpeg_runner.py#L43)）
- 5 つの実装ポイント（キャッシュ、fc-match, Verdana 検出、macOS fallback chain, LRU 最適化）
- 6 箇所での使用実績表
- デバッグ・テスト方法
- 文字化けエラー対策

#### ⏱️ [02-タイムライン計算ロジック](lv3/02-タイムライン計算ロジック.md)
セクション開始時刻・継続時間計算（実音声取得 or テキスト推定）

- 実装詳細：`build_timeline()` 関数（[src/timeline.py](../../src/timeline.py)）
- データクラス：`SectionTimeline`, `Timeline`
- 処理フロー（ffprobe 実行、テキスト長推定、duration_hint_sec 優先）
- ヘルパー関数（`_get_audio_duration()`, `_estimate_duration_from_text()`）
- CLI テスト・エラー対策

#### 🎞️ [03-FFmpegコマンド構築](lv3/03-FFmpegコマンド構築.md)
YAML + Timeline → complex filter string 生成

- 実装詳細：`build_ffmpeg_command()` 関数（[src/render/ffmpeg_runner.py](../../src/render/ffmpeg_runner.py#L200)）
- 6 フィルタ組合せ（drawtext, zoompan, sidechaincompress, concat, scale, pad）
- ビデオ/オーディオ filter chain 構築ステップ
- コーデック設定・入出力オプション
- Dry-run で実行前確認

#### 👁️ [04-プレビューウィンドウ実装](lv3/04-プレビューウィンドウ実装.md)
Desktop App（Electron）の Vue.js + Canvas リアルタイムプレビュー

- 実装詳細：`preview.js` コンポーネント（[desktop-app/src/renderer/preview.js](../../desktop-app/src/renderer/preview.js)）
- IPC メッセージ仕様（Main ←→ Renderer データ連携）
- Canvas 描画ロジック（背景→テロップボックス→テキスト→枠線）
- セクション選択・ナビゲーション
- エラーハンドリング（背景欠落、フォント文字化け）

#### 🔍 [05-テロップ調整検証システム](lv3/05-テロップ調整検証システム.md)
テロップはみ出し防止の3段階検証ロジック（初期判定→優先順位調整→再検証）

- 実装詳細：`verify_fit()` 関数、`adjust_section()` 改良版（[scripts/adjust_tickers.py](../../scripts/adjust_tickers.py)）
- 優先順位3段階：①文字サイズ縮小 → ②改行 → ③スケーリング（0.85倍）
- 複数回検証：段階1(初期)→段階2(調整)→段階3(最終)
- min_fontsize=40、scale_factor=0.85 で視認性と調整性を両立
- 36字以上の長文で短縮提案ログを出力
- Pillow `getbbox()` で複数行個別計測

---

## 🔗 参考ドキュメント

- **ドキュメント生成指示書**: [deepwiki_generation_instruction.md](../deepwiki_generation_instruction.md)
  - DeepWiki スタイル、Lv1/Lv2/Lv3 定義、出力ルール、AIプロンプト

- **関連コード**:
  - スクリプト生成：[scripts/generate_script_from_brief.py](../../scripts/generate_script_from_brief.py)
  - テロップ調整：[scripts/adjust_tickers.py](../../scripts/adjust_tickers.py)
  - 映像レンダリング：[scripts/generate_video.py](../../scripts/generate_video.py)
  - YouTube 投稿：[scripts/youtube_upload.py](../../scripts/youtube_upload.py)
  - タイムライン：[src/timeline.py](../../src/timeline.py)
  - FFmpeg 実行：[src/render/ffmpeg_runner.py](../../src/render/ffmpeg_runner.py)
  - プレビュー UI：[desktop-app/src/renderer/preview.js](../../desktop-app/src/renderer/preview.js)

---

## 📖 読む順序の推奨

### 🎯 パターン 1: システム全体を理解したい（1 時間）
1. **Lv1 概要** → システム全体像、主要機能把握
2. **Lv2 各機能** → 実際の運用フロー、パラメータ理解
3. **参考**: 実装ポイント、運用ガイド

### 🔧 パターン 2: 機能を開発・改善したい（2-3 時間）
1. **Lv2 対象機能** → 要件・仕様・エラー対策学習
2. **Lv3 対応モジュール** → 実装詳細、コード参照
3. **参考**: テスト方法、デバッグガイド

### 🐛 パターン 3: バグを修正したい（30 分）
1. **Lv1 概要** → 機能の位置づけ確認（5 分）
2. **Lv2 対象機能** → エラー対策表・落とし穴確認（10 分）
3. **Lv3 詳細仕様** → 実装・デバッグ方法（15 分）

---

## 📝 ドキュメント更新ルール

### 更新対象
- コード実装に影響する変更（関数シグネチャ、パラメータ、フロー）
- 新機能追加
- 既知のバグ・落とし穴発見

### 更新方法
1. 対応する **Lv2** または **Lv3** ドキュメントの **"追記ログ"** セクションに日付・内容を記載
2. 該当セクション本文を修正
3. 関連する別ドキュメントに影響がないか確認

### 例
```markdown
## 🗓️ 追記/更新ログ
- 2025-12-23: 初版
- 2025-12-24: テロップボックスの Y 座標を y=1700 に修正（ショート特化対応）
```

---

## 🚀 次のアクション
- 各 Lv3 ドキュメントの **テスト・再現方法** 拡充。
- CLI / GUI の 実行ガイド動画化。
- パフォーマンス最適化レベルの Lv4 詳細（1000+ 行、アルゴリズム解説）。
- 複数言語対応ドキュメント（英語、中国語）。

---

## 🗓️ 目次更新ログ
- 2025-12-23: 初版作成。Lv1/Lv2/Lv3 全ドキュメント統合。
